<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo FIFA 2025 - Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap');

        :root {
            --bg-color: #050505;
            --card-bg: #0a0a0a;
            --neon-blue: #00f3ff;
            --neon-green: #00ff41;
            --neon-pink: #ff00de;
            --neon-red: #ff3131;
            --grid-line: rgba(0, 243, 255, 0.1);
            --text-main: #e0e0e0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Space Mono', monospace;
            background-image:
                linear-gradient(rgba(0, 255, 65, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 65, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Scanline effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 100;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        header {
            text-align: center;
            padding: 3rem 1rem;
            position: relative;
            border-bottom: 2px solid var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue), inset 0 0 20px rgba(0, 243, 255, 0.2);
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            color: #fff;
            text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue), 0 0 40px var(--neon-blue);
            margin-bottom: 0.5rem;
            letter-spacing: 2px;
        }

        .subtitle {
            color: var(--neon-pink);
            font-size: 1.2rem;
            text-shadow: 0 0 5px var(--neon-pink);
            letter-spacing: 4px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            position: relative;
            z-index: 1;
        }

        /* Standings Table */
        .standings-section {
            margin-bottom: 4rem;
        }

        .neon-table-container {
            overflow-x: auto;
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(5px);
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.1rem;
        }

        th {
            background: rgba(0, 243, 255, 0.1);
            color: var(--neon-blue);
            padding: 1rem;
            text-align: left;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--neon-blue);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid rgba(0, 243, 255, 0.2);
            transition: all 0.2s;
        }

        tr:hover td {
            background: rgba(0, 243, 255, 0.1);
            color: #fff;
            text-shadow: 0 0 5px #fff;
        }

        .rank-cell {
            font-weight: bold;
            color: var(--neon-green);
        }

        .team-cell {
            font-weight: bold;
        }

        .points-cell {
            color: var(--neon-pink);
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 0 0 5px var(--neon-pink);
        }

        /* Matches Section */
        .matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .match-card {
            background: #0d0d0d;
            border: 1px solid var(--neon-green);
            padding: 1.5rem;
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .match-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
        }

        .match-header {
            color: var(--neon-green);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px dashed var(--neon-green);
            padding-bottom: 0.5rem;
        }

        .match-teams {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .match-score {
            font-weight: bold;
            color: var(--neon-pink);
            margin-left: auto;
        }

        .empty-match {
            color: #555;
            font-style: italic;
        }

        /* Stats */
        .stats-ticker {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            background: rgba(255, 0, 222, 0.05);
            padding: 1rem;
            border-left: 4px solid var(--neon-pink);
        }

        .stat-item {
            font-size: 0.9rem;
        }

        .stat-label {
            color: var(--neon-pink);
            text-transform: uppercase;
            font-size: 0.7rem;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
        }

        footer {
            text-align: center;
            padding: 2rem;
            margin-top: 4rem;
            color: #666;
            font-size: 0.8rem;
            border-top: 1px solid #333;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            th,
            td {
                padding: 0.8rem 0.5rem;
                font-size: 0.9rem;
            }

            .matches-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <header>
        <h1>TORNEO FIFA 2025</h1>
        <div class="subtitle">CLASSIFICA LIVE</div>
    </header>

    <div class="container">

        <div id="stats-area" class="stats-ticker">
            <!-- JS injected stats -->
            <div class="stat-item">Caricamento statistiche...</div>
        </div>

        <section class="standings-section">
            <h2 style="color: var(--neon-blue); margin-bottom: 1rem; text-shadow: 0 0 10px var(--neon-blue);">CLASSIFICA
                GENERALE</h2>
            <div class="neon-table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Squadra</th>
                            <th>G</th>
                            <th>V/P/S (Pts)</th>
                            <th>GF</th>
                            <th>GS</th>
                            <th>DR</th>
                            <th>Punti</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body">
                        <tr>
                            <td colspan="8" style="text-align:center">Caricamento dati...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section>
            <h2 style="color: var(--neon-green); margin-bottom: 1rem; text-shadow: 0 0 10px var(--neon-green);">
                CALENDARIO PARTITE</h2>
            <div id="matches-container" class="matches-grid">
                <!-- JS injected matches -->
            </div>
        </section>

    </div>

    <footer>
        <div id="last-update">Ultimo aggiornamento: --</div>
        <br>
        <a href="#" style="color: #666; text-decoration: none;">GitHub Repository</a>
    </footer>

    <script>
        async function fetchData() {
            try {
                // Anti-cache param
                const t = new Date().getTime();

                const [standingsRes, matchesRes] = await Promise.all([
                    fetch('classifica.json?t=' + t),
                    fetch('matches.json?t=' + t)
                ]);

                if (!standingsRes.ok || !matchesRes.ok) throw new Error("File missing");

                const standingsData = await standingsRes.json();
                const matchesData = await matchesRes.json();

                renderStandings(standingsData.classifica);
                
                // Combine league matches and playoffs
                const allMatches = [...(matchesData.matches || []), ...(matchesData.playoffs || [])];
                renderMatches(allMatches);

                document.getElementById('last-update').textContent = 'Ultimo aggiornamento: ' + (standingsData.ultimo_aggiornamento || 'N/A');

                calculateStats(standingsData.classifica);

            } catch (e) {
                console.error("Error fetching data:", e);
            }
        }

        function renderStandings(data) {
            const tbody = document.getElementById('standings-body');
            tbody.innerHTML = '';

            data.forEach(team => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                <td class="rank-cell">#${team.posizione}</td>
                <td class="team-cell">${team.squadra}</td>
                <td>${team.giornate}</td>
                <td>-</td>
                <td>${team.gol_fatti}</td>
                <td>${team.gol_subiti}</td>
                <td style="color: ${team.differenza_reti >= 0 ? 'var(--neon-green)' : 'var(--neon-red)'}">
                    ${team.differenza_reti > 0 ? '+' : ''}${team.differenza_reti}
                </td>
                <td class="points-cell">${team.punti}</td>
            `;
                tbody.appendChild(tr);
            });
        }

        function renderMatches(matches) {
            const container = document.getElementById('matches-container');
            container.innerHTML = '';

            // Show only active or future matches (or last 5 + next 5, but for now show all sorted)
            // Let's show grouped by Matchday (Giornata)
            // Group matches by jornada
            const grouped = {};
            matches.forEach(m => {
                if (!grouped[m.giornata]) grouped[m.giornata] = [];
                grouped[m.giornata].push(m);
            });

            // Find next matchday (first with non-completed matches)
            let nextDay = 1;
            // Simple logic: show all for now, maybe filtered in V2
            // Just showing latest/upcoming

            // Sort: Numbers first, then Strings (Playoffs)
            matches.sort((a, b) => {
                const idA = a.id;
                const idB = b.id;
                const isNumA = typeof idA === 'number';
                const isNumB = typeof idB === 'number';

                if (isNumA && isNumB) return idA - idB;
                if (isNumA) return -1;
                if (isNumB) return 1;
                // Both strings
                return String(idA).localeCompare(String(idB));
            });

            matches.forEach(m => {
                const card = document.createElement('div');
                card.className = 'match-card';

                let status = "DA GIOCARE";
                let score = "";
                let scoreClass = "empty-match";

                if (m.risultato) {
                    status = "TERMINATA";
                    score = `${m.gol_a} - ${m.gol_b}`;
                    scoreClass = "match-score";
                    if (m.risultato.startsWith("rigori")) score += " (dcr)";
                }

                card.innerHTML = `
                <div class="match-header">
                    <span>GIORNATA ${m.giornata}</span>
                    <span>${status}</span>
                </div>
                <div class="match-teams">
                    <div style="display:flex; justify-content:space-between">
                        <span>${m.squadra_a}</span>
                        ${m.risultato ? `<span>${m.gol_a}</span>` : ''}
                    </div>
                    <div style="display:flex; justify-content:space-between">
                        <span>${m.squadra_b}</span>
                        ${m.risultato ? `<span>${m.gol_b}</span>` : ''}
                    </div>
                </div>
            `;
                container.appendChild(card);
            });
        }

        function calculateStats(ranking) {
            if (!ranking.length) return;

            const topScorerTeam = ranking.reduce((prev, current) => (prev.gol_fatti > current.gol_fatti) ? prev : current);
            const defenseTeam = ranking.reduce((prev, current) => (prev.gol_subiti < current.gol_subiti) ? prev : current);

            const statsArea = document.getElementById('stats-area');
            statsArea.innerHTML = `
            <div class="stat-item">
                <div class="stat-label">Miglior Attacco</div>
                <div class="stat-value" style="color: var(--neon-green)">${topScorerTeam.squadra} (${topScorerTeam.gol_fatti})</div>
            </div>
             <div class="stat-item">
                <div class="stat-label">Miglior Difesa</div>
                <div class="stat-value" style="color: var(--neon-blue)">${defenseTeam.squadra} (${defenseTeam.gol_subiti})</div>
            </div>
             <div class="stat-item">
                <div class="stat-label">Totale Squadre</div>
                <div class="stat-value">${ranking.length}</div>
            </div>
        `;
        }

        // Init
        fetchData();
        // Auto refresh
        setInterval(fetchData, 30000);
    </script>

</body>

</html>